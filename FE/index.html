<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookly - Trang ch·ªß</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="luxury.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800;900&family=Cormorant+Garamond:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  </head>
  <body>
  <!-- SVG Icons -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="user" viewBox="0 0 24 24">
      <path fill="currentColor" fill-rule="evenodd" d="M12 1.25a4.75 4.75 0 1 0 0 9.5a4.75 4.75 0 0 0 0-9.5M8.75 6a3.25 3.25 0 1 1 6.5 0a3.25 3.25 0 0 1-6.5 0M12 12.25c-2.313 0-4.445.526-6.024 1.414C4.42 14.54 3.25 15.866 3.25 17.5v.102c-.001 1.162-.002 2.62 1.277 3.662c.629.512 1.51.877 2.7 1.117c1.192.242 2.747.369 4.773.369s3.58-.127 4.774-.369c1.19-.24 2.07-.605 2.7-1.117c1.279-1.042 1.277-2.5 1.276-3.662V17.5c0-1.634-1.17-2.96-2.725-3.836c-1.58-.888-3.711-1.414-6.025-1.414M4.75 17.5c0-.851.622-1.775 1.961-2.528c1.316-.74 3.184-1.222 5.29-1.222c2.104 0 3.972.482 5.288 1.222c1.34.753 1.961 1.677 1.961 2.528c0 1.308-.04 2.044-.724 2.6c-.37.302-.99.597-2.05.811c-1.057.214-2.502.339-4.476.339c-1.974 0-3.42-.125-4.476-.339c-1.06-.214-1.68-.509-2.05-.81c-.684-.557-.724-1.293-.724-2.601" clip-rule="evenodd"/>
      </symbol>
    <symbol id="cart" viewBox="0 0 24 24">
      <path fill="currentColor" fill-rule="evenodd" d="M2.249 2.292a.75.75 0 1 0-.498 1.416l.262.091c.667.235 1.106.39 1.429.549c.303.149.437.27.525.398c.09.132.16.314.2.677c.04.38.041.875.041 1.615V9.76c0 1.453.014 2.5.151 3.3c.146.854.438 1.466.985 2.042c.594.627 1.346.9 2.243 1.026c.858.122 1.948.122 3.293.122h5.406c.742 0 1.366 0 1.87-.062c.537-.065 1.025-.209 1.452-.556c.426-.348.665-.797.837-1.309c.163-.482.289-1.093.439-1.82l.508-2.469l.002-.005l.01-.052c.165-.825.303-1.519.338-2.077c.036-.586-.031-1.164-.413-1.66c-.235-.306-.565-.479-.866-.584a4.617 4.617 0 0 0-1.002-.21c-.687-.076-1.522-.076-2.34-.076H5.667a5.932 5.932 0 0 0-.01-.108c-.054-.497-.17-.95-.453-1.362c-.284-.416-.662-.682-1.102-.899c-.412-.202-.936-.386-1.553-.603zm3.46 4.578h11.38c.856 0 1.61.001 2.205.067c.296.034.517.08.672.134a.56.56 0 0 1 .176.086c.062.082.128.23.102.651c-.027.444-.143 1.036-.321 1.926v.002l-.5 2.42c-.16.783-.27 1.303-.399 1.688c-.123.366-.239.523-.364.625c-.125.102-.303.184-.685.23c-.404.05-.935.051-1.734.051h-5.303c-1.417 0-2.4-.002-3.14-.107c-.716-.101-1.093-.285-1.366-.573c-.32-.338-.493-.668-.595-1.263c-.11-.65-.129-1.558-.129-3.047zM7.5 21.75a2.25 2.25 0 1 1 0-4.5a2.25 2.25 0 0 1 0 4.5m-.75-2.25a.75.75 0 1 0 1.5 0a.75.75 0 0 0-1.5 0m9.75 2.25a2.25 2.25 0 1 1 0-4.5a2.25 2.25 0 0 1 0 4.5m-.75-2.25a.75.75 0 1 0 1.5 0a.75.75 0 0 0-1.5 0" clip-rule="evenodd"/>
      </symbol>
    </svg>

  <!-- Header -->
  <header class="site-header glass-navbar">
    <nav class="navbar navbar-expand-lg">
        <div class="container">
          <a class="navbar-brand" href="index.html">
          <img src="images/main-logo.png" class="logo" alt="Bookly">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" style="border-color: var(--luxury-gold);">
          <span class="navbar-toggler-icon" style="background-image: url('data:image/svg+xml,%3csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 30 30\'%3e%3cpath stroke=\'rgba(212, 175, 55, 1)\' stroke-linecap=\'round\' stroke-miterlimit=\'10\' stroke-width=\'2\' d=\'M4 7h22M4 15h22M4 23h22\'/%3e%3c/svg%3e');"></span>
          </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav mx-auto align-items-center">
            <li class="nav-item"><a class="nav-link active" href="index.html">Trang ch·ªß</a></li>
            <li class="nav-item"><a class="nav-link" href="category.html">S√°ch</a></li>
            <li class="nav-item"><a class="nav-link" href="about.html">V·ªÅ ch√∫ng t√¥i</a></li>
            <li class="nav-item"><a class="nav-link" href="contact.html">Li√™n h·ªá</a></li>
                  </ul>
          <ul class="navbar-nav ms-auto align-items-center">
            <li class="nav-item pe-3 position-relative">
              <a href="cart.html" class="nav-link cursor-pointer">
                <svg class="cart" width="24" height="24"><use xlink:href="#cart"></use></svg>
                <span id="cart-count" class="badge position-absolute top-0 start-100 translate-middle" style="background: var(--luxury-gold); color: var(--luxury-black);">0</span>
                    </a>
                  </li>
            <li class="nav-item dropdown" style="position: relative;">
              <a href="login.html" id="auth-trigger" class="nav-link cursor-pointer">
                <svg class="user" width="24" height="24"><use xlink:href="#user"></use></svg>
              </a>
              <span id="greet-text" class="nav-link" style="display:none; cursor:pointer;"></span>
                        </li>
                      </ul>
          </div>
        </div>
      </nav>
    </header>

  <!-- Luxury Hero Section -->
  <section class="hero-luxury">
    <div class="hero-content">
      <h1 class="hero-title">Kh√°m Ph√° Th·∫ø Gi·ªõi S√°ch</h1>
      <p class="hero-subtitle">N∆°i VƒÉn H·ªçc G·∫∑p G·ª° S·ª± Tinh T·∫ø</p>
      <p class="hero-description">
        Ch√†o m·ª´ng ƒë·∫øn v·ªõi Bookly - n∆°i m·ªói cu·ªën s√°ch l√† m·ªôt t√°c ph·∫©m ngh·ªá thu·∫≠t, 
        m·ªói trang gi·∫•y l√† m·ªôt h√†nh tr√¨nh kh√°m ph√°. Ch√∫ng t√¥i mang ƒë·∫øn cho b·∫°n 
        nh·ªØng ·∫•n ph·∫©m ƒë∆∞·ª£c tuy·ªÉn ch·ªçn k·ªπ l∆∞·ª°ng, n∆°i tri th·ª©c v√† v·∫ª ƒë·∫πp h√≤a quy·ªán.
      </p>
      <div class="d-flex gap-3 justify-content-center flex-wrap">
        <a href="category.html" class="btn btn-luxury">Kh√°m Ph√° B·ªô S∆∞u T·∫≠p</a>
        <a href="#story" class="btn btn-luxury-outline">C√¢u Chuy·ªán C·ªßa Ch√∫ng T√¥i</a>
        </div>
      </div>
    </section>

  <!-- Storytelling Section -->
  <section id="story" class="story-section">
      <div class="container">
      <div class="story-content glass-section">
        <h2 class="story-title">C√¢u Chuy·ªán C·ªßa Ch√∫ng T√¥i</h2>
        <p class="story-text">
          Bookly ƒë∆∞·ª£c sinh ra t·ª´ ni·ªÅm ƒëam m√™ v·ªõi vƒÉn h·ªçc v√† mong mu·ªën t·∫°o ra m·ªôt kh√¥ng gian 
          n∆°i nh·ªØng ng∆∞·ªùi y√™u s√°ch c√≥ th·ªÉ t√¨m th·∫•y nh·ªØng t√°c ph·∫©m xu·∫•t s·∫Øc nh·∫•t. T·ª´ nh·ªØng 
          cu·ªën s√°ch c·ªï ƒëi·ªÉn v∆∞·ª£t th·ªùi gian ƒë·∫øn nh·ªØng t√°c ph·∫©m ƒë∆∞∆°ng ƒë·∫°i ƒë·∫ßy c·∫£m h·ª©ng, ch√∫ng 
          t√¥i t·ª± h√†o mang ƒë·∫øn cho b·∫°n m·ªôt b·ªô s∆∞u t·∫≠p ƒë∆∞·ª£c tuy·ªÉn ch·ªçn c·∫©n th·∫≠n.
        </p>
        <p class="story-text">
          M·ªói cu·ªën s√°ch trong kho c·ªßa ch√∫ng t√¥i ƒë·ªÅu ƒë∆∞·ª£c ch·ªçn l·ªçc d·ª±a tr√™n ch·∫•t l∆∞·ª£ng n·ªôi dung, 
          v·∫ª ƒë·∫πp c·ªßa ·∫•n ph·∫©m, v√† gi√° tr·ªã vƒÉn h√≥a. Ch√∫ng t√¥i tin r·∫±ng s√°ch kh√¥ng ch·ªâ l√† ph∆∞∆°ng 
          ti·ªán truy·ªÅn t·∫£i th√¥ng tin, m√† c√≤n l√† t√°c ph·∫©m ngh·ªá thu·∫≠t c·∫ßn ƒë∆∞·ª£c tr√¢n tr·ªçng.
        </p>
        <img src="images/banner-image.png" alt="Our Story" class="story-image">
        </div>
      </div>
    </section>

  <!-- Brand Values -->
  <section class="padding-large py-5">
      <div class="container">
      <h2 class="section-title-luxury">Gi√° Tr·ªã C·ªët L√µi</h2>
      <div class="values-grid">
        <div class="value-card glass-card">
          <div class="value-icon">‚ú®</div>
          <h3 class="value-title">Ch·∫•t L∆∞·ª£ng Tuy·ªát ƒê·ªëi</h3>
          <p class="value-description">
            M·ªói cu·ªën s√°ch ƒë∆∞·ª£c tuy·ªÉn ch·ªçn k·ªπ l∆∞·ª°ng, ƒë·∫£m b·∫£o ch·∫•t l∆∞·ª£ng n·ªôi dung v√† ·∫•n ph·∫©m 
            ƒë·∫°t ti√™u chu·∫©n cao nh·∫•t.
          </p>
        </div>
        <div class="value-card glass-card">
          <div class="value-icon">üé®</div>
          <h3 class="value-title">Th·∫©m M·ªπ Tinh T·∫ø</h3>
          <p class="value-description">
            Ch√∫ng t√¥i coi s√°ch l√† t√°c ph·∫©m ngh·ªá thu·∫≠t, t·ª´ thi·∫øt k·∫ø b√¨a ƒë·∫øn ch·∫•t l∆∞·ª£ng gi·∫•y, 
            m·ªçi chi ti·∫øt ƒë·ªÅu ƒë∆∞·ª£c chƒÉm ch√∫t.
          </p>
        </div>
        <div class="value-card glass-card">
          <div class="value-icon">üìö</div>
          <h3 class="value-title">Tri Th·ª©c S√¢u S·∫Øc</h3>
          <p class="value-description">
            B·ªô s∆∞u t·∫≠p ƒëa d·∫°ng t·ª´ vƒÉn h·ªçc c·ªï ƒëi·ªÉn ƒë·∫øn t√°c ph·∫©m ƒë∆∞∆°ng ƒë·∫°i, mang ƒë·∫øn cho b·∫°n 
            nh·ªØng g√≥c nh√¨n m·ªõi m·∫ª v√† s√¢u s·∫Øc.
          </p>
        </div>
        <div class="value-card glass-card">
          <div class="value-icon">üíé</div>
          <h3 class="value-title">ƒê·ªôc Quy·ªÅn & Hi·∫øm C√≥</h3>
          <p class="value-description">
            Nhi·ªÅu ·∫•n ph·∫©m gi·ªõi h·∫°n v√† phi√™n b·∫£n ƒë·∫∑c bi·ªát ch·ªâ c√≥ t·∫°i Bookly, d√†nh cho nh·ªØng 
            ng∆∞·ªùi s∆∞u t·∫ßm s√°ch th·ª±c th·ª•.
          </p>
          </div>
        </div>
      </div>
    </section>

  <!-- Promotions Section -->
  <section class="padding-large py-5" id="promotions-section">
      <div class="container">
      <h2 class="section-title-luxury">Khuy·∫øn M√£i ƒê·∫∑c Bi·ªát</h2>
      <div class="row" id="promotions-grid">
        <!-- Will be populated by JS -->
      </div>
      </div>
    </section>

  <!-- Premium Product Showcase -->
  <section class="padding-large py-5">
      <div class="container">
      <h2 class="section-title-luxury">B·ªô S∆∞u T·∫≠p ƒê·ªôc Quy·ªÅn</h2>
      <div class="row" id="best-sellers-grid">
        <!-- Will be populated by JS -->
        </div>
      </div>
    </section>

  <!-- New Arrivals -->
  <section class="padding-large py-5">
      <div class="container">
      <h2 class="section-title-luxury">S√°ch M·ªõi Ra M·∫Øt</h2>
      <div class="row" id="new-arrivals-grid">
        <!-- Will be populated by JS -->
        </div>
      </div>
    </section>

  <!-- Categories -->
  <section class="padding-large py-5">
      <div class="container">
      <h2 class="section-title-luxury">Danh M·ª•c S√°ch</h2>
      <div class="row" id="categories-grid">
        <!-- Will be populated by JS -->
        </div>
      </div>
    </section>

  <!-- Exclusive Membership CTA -->
  <section class="membership-cta">
      <div class="container">
      <div class="membership-content">
        <h2 class="membership-title">Th√†nh Vi√™n ƒê·ªôc Quy·ªÅn</h2>
        <p class="membership-subtitle">Tr·∫£i Nghi·ªám ƒê·∫∑c Quy·ªÅn D√†nh Ri√™ng Cho B·∫°n</p>
        <ul class="membership-benefits">
          <li>∆Øu ƒë√£i ƒë·∫∑c bi·ªát l√™n ƒë·∫øn 20% cho m·ªçi ƒë∆°n h√†ng</li>
          <li>Ti·∫øp c·∫≠n s·ªõm c√°c ·∫•n ph·∫©m gi·ªõi h·∫°n v√† phi√™n b·∫£n ƒë·∫∑c bi·ªát</li>
          <li>Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn cho m·ªçi ƒë∆°n h√†ng</li>
          <li>Qu√† t·∫∑ng ƒë·ªôc quy·ªÅn v√† s·ª± ki·ªán ri√™ng t∆∞</li>
          <li>D·ªãch v·ª• t∆∞ v·∫•n s√°ch c√° nh√¢n h√≥a</li>
        </ul>
        <a href="register.html" class="btn btn-luxury">ƒêƒÉng K√Ω Ngay</a>
        </div>
      </div>
    </section>

  <!-- Footer -->
  <footer class="site-footer">
      <div class="container">
        <div class="row">
          <div class="col-md-4 mb-4">
          <h5>V·ªÅ Bookly</h5>
          <p>Nh√† s√°ch tr·ª±c tuy·∫øn h√†ng ƒë·∫ßu Vi·ªát Nam, n∆°i vƒÉn h·ªçc g·∫∑p g·ª° s·ª± tinh t·∫ø. 
            Ch√∫ng t√¥i t·ª± h√†o mang ƒë·∫øn nh·ªØng t√°c ph·∫©m ƒë∆∞·ª£c tuy·ªÉn ch·ªçn k·ªπ l∆∞·ª°ng, 
            n∆°i tri th·ª©c v√† v·∫ª ƒë·∫πp h√≤a quy·ªán.</p>
                  </div>
          <div class="col-md-4 mb-4">
          <h5>Li√™n h·ªá</h5>
          <p>Email: info@bookly.vn</p>
          <p>ƒêi·ªán tho·∫°i: 1900-xxxx</p>
          <p>ƒê·ªãa ch·ªâ: 123 ƒê∆∞·ªùng S√°ch, Qu·∫≠n 1, TP.HCM</p>
                </div>
          <div class="col-md-4 mb-4">
          <h5>Theo d√µi ch√∫ng t√¥i</h5>
          <p>
            <a href="#" class="text-luxury-gold me-3">Facebook</a> | 
            <a href="#" class="text-luxury-gold me-3">Instagram</a> | 
            <a href="#" class="text-luxury-gold">Twitter</a>
          </p>
              </div>
                </div>
          <div class="row mt-4 pt-4 border-top" style="border-color: rgba(212, 175, 55, 0.2) !important;">
            <div class="col-12 text-center">
              <p class="mb-0" style="color: rgba(255, 255, 255, 0.5);">
                ¬© 2025 Bookly. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.
              </p>
          </div>
        </div>
      </div>
    </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/app.js"></script>
  <script>
    // renderBookCard is now async and handles promotions automatically in app.js

    // Load categories
    (async () => {
      try {
        const categories = await window.apiRequest("/api/categories");
        const catList = Array.isArray(categories) ? categories : [];
        const grid = document.getElementById("categories-grid");
        if (grid) {
          grid.innerHTML = catList.slice(0, 4).map(cat => `
            <div class="col-md-3 mb-4">
              <div class="glass-card value-card cursor-pointer" onclick="window.location.href='category.html?category=${cat.categoryId || cat.CategoryId}'">
                <h5 class="value-title">${cat.categoryName || cat.CategoryName}</h5>
                <a href="category.html?category=${cat.categoryId || cat.CategoryId}" class="btn btn-luxury-outline btn-sm">Xem s√°ch</a>
              </div>
            </div>
          `).join("");
        }
      } catch (err) {
        console.error("Load categories failed:", err);
      }
    })();

    // Load best sellers
    (async () => {
      try {
        let orders;
        try {
          orders = await window.apiRequest("/api/admin/orders?page=1&pageSize=200");
        } catch {
          orders = [];
        }
        const orderList = Array.isArray(orders) ? orders : (orders?.data || []);
        const bookCounts = {};
        orderList.forEach(order => {
          const details = order.orderDetails || order.OrderDetails || [];
          details.forEach(detail => {
            const bookId = detail.bookId || detail.BookId;
            const qty = detail.quantity || detail.Quantity || 0;
            if (bookId) bookCounts[bookId] = (bookCounts[bookId] || 0) + qty;
          });
        });
        const topIds = Object.entries(bookCounts).sort((a,b) => b[1]-a[1]).slice(0, 8).map(([id]) => Number(id));
        const books = [];
        for (const id of topIds) {
          try {
            const book = await window.apiRequest(`/api/books/${id}`);
            if (book) books.push(book);
          } catch {}
        }
        if (books.length > 0) {
          window.renderGrid("best-sellers-grid", books);
        } else {
          const response = await window.apiRequest("/api/books?page=1&pageSize=8&sortBy=created_at&sortOrder=desc");
          const fallbackBooks = Array.isArray(response) ? response : (response?.data || []);
          window.renderGrid("best-sellers-grid", fallbackBooks);
        }
      } catch (err) {
        console.error("Load best sellers failed:", err);
        try {
          const response = await window.apiRequest("/api/books?page=1&pageSize=8&sortBy=created_at&sortOrder=desc");
          const fallbackBooks = Array.isArray(response) ? response : (response?.data || []);
          window.renderGrid("best-sellers-grid", fallbackBooks);
        } catch {}
      }
    })();

    // Load new arrivals
    (async () => {
      try {
        const response = await window.apiRequest("/api/books?page=1&pageSize=8&sortBy=created_at&sortOrder=desc");
        const books = Array.isArray(response) ? response : (response?.data || []);
        window.renderGrid("new-arrivals-grid", books);
      } catch (err) {
        console.error("Load new arrivals failed:", err);
      }
    })();

    // Load promotions
    (async () => {
      try {
        const promotions = await window.apiRequest("/api/admin/promotions");
        const activePromotions = (Array.isArray(promotions) ? promotions : []).filter(p => {
          const now = new Date();
          const startDate = new Date(p.startDate || p.StartDate);
          const endDate = new Date(p.endDate || p.EndDate);
          return (p.isActive || p.IsActive) && now >= startDate && now <= endDate;
        });

        if (activePromotions.length > 0) {
          const promotionBooks = [];
          for (const promo of activePromotions) {
            const items = promo.promotionItems || promo.PromotionItems || [];
            for (const item of items) {
              const bookId = item.bookId || item.BookId;
              if (bookId) {
                try {
                  const book = await window.apiRequest(`/api/books/${bookId}`);
                  if (book) {
                    // Attach promotion info to book for reference
                    book._promotionInfo = {
                      promotionId: promo.promotionId || promo.PromotionId,
                      promotionType: promo.promotionType || promo.PromotionType,
                      discountValue: promo.discountValue || promo.DiscountValue,
                      specificDiscount: item.specificDiscount || item.SpecificDiscount
                    };
                    promotionBooks.push(book);
                  }
                } catch (err) {
                  console.warn(`Failed to load book ${bookId} for promotion:`, err);
                }
              }
            }
          }
          // Remove duplicates
          const uniqueBooks = promotionBooks.filter((book, index, self) => {
            const bookId = book.bookId || book.BookId;
            return index === self.findIndex(b => (b.bookId || b.BookId) === bookId);
          });
          if (uniqueBooks.length > 0) {
            window.renderGrid("promotions-grid", uniqueBooks.slice(0, 8));
            document.getElementById("promotions-section").style.display = "block";
          } else {
            document.getElementById("promotions-section").style.display = "none";
          }
        } else {
          document.getElementById("promotions-section").style.display = "none";
        }
      } catch (err) {
        console.error("Load promotions failed:", err);
        document.getElementById("promotions-section").style.display = "none";
      }
    })();

    // Bind add to cart buttons
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('btn-add-cart')) {
        e.preventDefault();
        const bookId = Number(e.target.dataset.bookId);
        if (!window.state.userId) {
          alert("Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc khi th√™m v√†o gi·ªè h√†ng.");
          window.location.href = "login.html";
          return;
        }
        (async () => {
          try {
            await window.apiRequest("/api/cart/add", {
              method: "POST",
              body: JSON.stringify({ userId: window.state.userId, bookId, quantity: 1 }),
            });
            alert("ƒê√£ th√™m v√†o gi·ªè h√†ng");
            window.loadCartCount();
          } catch (err) {
            console.error("Add to cart failed:", err);
            alert("Kh√¥ng th·ªÉ th√™m v√†o gi·ªè h√†ng");
          }
        })();
      }
    });
  </script>
  </body>
</html>
